esphome:
  name: zima

esp8266:
  board: nodemcu

logger:

api:
  #If you enable MQTT and you do not use the “native API” for Home Assistant, you must remove the api: line from your ESPHome configuration, otherwise the ESP will reboot every 15 minutes because no client connected to the native API.
  reboot_timeout: 0s
  password: ""
  services:
    - service: vyvetrat
      then:
        - switch.turn_on: vetrak
        - delay: 3s
        - switch.turn_off: vetrak

    - service: zablikat
      variables:
        my_brightness: int
        my_effect: string
      then:
#        - light.turn_on:
#            id: my_light
#            brightness: !lambda 'return my_brightness;'
#            effect: !lambda 'return my_effect;'

ota:
  password: ""

wifi:
  ssid: !secret ssid
  password: !secret password

  # Optional manual IP
  manual_ip:
    static_ip: 192.168.8.30
    gateway: 192.168.8.1
    subnet: 255.255.255.0
    dns1: 192.168.8.1
  
  ap:
    password: !secret fallback_password

    
    
captive_portal:





globals:
   - id: heating_global_bool
     type: bool
     restore_value: no
     initial_value: '0'
     




switch:
  - platform: template
    name: heating_global_switch
    id: heating_global_switch
    lambda: |- 
      return id(heating_global_bool);
    optimistic: true

  - platform: gpio
    id: ventil
    name: ventil
    pin: 
        number: D1
        inverted: true
    
  - platform: gpio
    name: "vetrak"
    id: vetrak
    pin: D2

  - platform: gpio
    name: "onboard_led"
    pin: GPIO16
    inverted: true
    
  - platform: gpio
    name: "onboard_led2"
    pin: GPIO2
    inverted: true
 
    
sensor:
  - platform: dht
    pin: D5
    temperature:
      name: "onboard temp 2"
    humidity:
      name: "onboard hum 2"
    update_interval: 3s

  - platform: dht
    pin: D7
    temperature:
      name: "onboard temp 1"
    humidity:
      name: "onboard hum 1"
    update_interval: 3s

  - platform: dallas
    index: 0
    id: "central_air_temperature"
    name: "central_air_temperature"

  - platform: dallas
    index: 1
    id: radiator
    name: radiator


    
climate:
  - platform: thermostat
    name: "Thermostat Climate Controller"
    sensor: central_air_temperature
    
    min_cooling_off_time: 3s
    min_cooling_run_time: 3s
    min_heating_off_time: 3s
    min_heating_run_time: 3s
    min_idle_time: 3s
    
    cool_action:
      - switch.turn_on: vetrak
    heat_action:
      - switch.turn_on: heating_global_switch
    idle_action:
      - switch.turn_off: vetrak
      - switch.turn_off: heating_global_switch

    default_preset: sleep
    on_boot_restore_from: memory
    preset:
      - name: sleep
        mode: heat_cool
        default_target_temperature_low: 15 °C
        default_target_temperature_high: 21 °C
      - name: work
        mode: heat_cool
        default_target_temperature_low: 19 °C
        default_target_temperature_high: 21 °C



interval:
  - interval: 5s
    then:
      - lambda: |-
          if (id(heating_global_bool)) {
            id(ventil).turn_on();
          } else {
            if (id(radiator).state > 25) {
              id(ventil).turn_off();
            } else {
              id(ventil).turn_on();
            }
          }
          


web_server:
  port: 80
  ota: true

dallas:
  - pin: D6
    update_interval: 3s


# Only pins that support both input & output have integrated pull-up and pull-down resistors. Input-only GPIOs 34-39 do not.



mqtt:
  broker: !secret mqtt_host
  port: !secret mqtt_port
  username: !secret mqtt_user
  password: !secret mqtt_password
  keepalive: 10s
  reboot_timeout: 50min

